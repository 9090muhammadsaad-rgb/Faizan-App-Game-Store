<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faizan Market Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        body { font-family: 'Outfit', sans-serif; transition: background 0.3s, color 0.3s; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        /* Automatic Light/Dark Text */
        .dark { background-color: #0a0a0f; color: #ffffff; }
        .light { background-color: #f8fafc; color: #0f172a; }
    </style>
</head>
<body x-data="storeEngine()" :class="darkMode ? 'dark' : 'light'" x-cloak>

    <nav class="sticky top-0 z-[100] p-4 bg-inherit border-b border-gray-500/10 flex items-center gap-3">
        <div @click="resetAll()" class="text-xl font-black text-blue-600 cursor-pointer">FAIZAN</div>
        <div class="flex-1 relative">
            <input type="text" x-model="searchQuery" 
                   placeholder="Try 'allgame' or 'pub:Garena'..." 
                   class="w-full pl-10 pr-4 py-2 rounded-xl bg-gray-500/10 border-none outline-none text-sm font-semibold">
            <span class="absolute left-3 top-2.5 opacity-40">üîç</span>
        </div>
    </nav>

    <main x-show="!viewingDetail" class="p-4 pb-20">
        
        <template x-if="shouldShowOffer() && getOffer()">
            <div class="mb-6">
                <div @click="openDetail(getOffer())" class="relative h-48 rounded-3xl overflow-hidden shadow-2xl">
                    <video :src="getOffer().assets.video" autoplay muted loop playsinline class="w-full h-full object-cover"></video>
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent p-4 flex flex-col justify-end">
                        <h2 class="text-white text-lg font-black" x-text="getOffer().name"></h2>
                        <p class="text-white/60 text-[10px]" x-text="'Featured ' + getOffer().type"></p>
                    </div>
                </div>
            </div>
        </template>

        <div class="grid-3">
            <template x-for="app in filteredApps" :key="app.id">
                <div @click="openDetail(app)" class="p-2 rounded-2xl text-center active:scale-95 transition-transform bg-gray-500/5 border border-gray-500/10">
                    <img :src="app.icon" class="w-16 h-16 rounded-[1.5rem] mx-auto mb-2 shadow-md">
                    <p class="text-[10px] font-black truncate" x-text="app.name"></p>
                    <p class="text-[8px] opacity-50 uppercase font-bold" x-text="app.category"></p>
                </div>
            </template>
        </div>

        <div x-show="filteredApps.length === 0" class="mt-20 text-center opacity-40 font-bold italic">Command Not Found...</div>
    </main>

    <div x-show="viewingDetail" class="fixed inset-0 z-[110] bg-inherit overflow-y-auto" x-transition>
        <template x-if="selectedApp">
            <div class="pb-24">
                <div class="p-4 sticky top-0 bg-inherit z-20 flex items-center gap-4 border-b border-gray-500/10">
                    <button @click="viewingDetail = false" class="text-2xl">‚Üê</button>
                    <span class="font-bold text-sm" x-text="selectedApp.name"></span>
                </div>

                <div class="p-6 flex gap-5">
                    <img :src="selectedApp.icon" class="w-24 h-24 rounded-[2rem] shadow-2xl">
                    <div class="flex-1 self-center">
                        <h1 class="text-2xl font-black" x-text="selectedApp.name"></h1>
                        <p @click="searchQuery = 'pub:'+selectedApp.owner; viewingDetail = false" 
                           class="text-blue-500 font-bold text-sm cursor-pointer" x-text="selectedApp.owner"></p>
                        <p class="text-[10px] opacity-40 font-mono" x-text="selectedApp.package"></p>
                    </div>
                </div>

                <div class="px-6 mb-8 overflow-x-auto flex gap-3 no-scrollbar">
                    <template x-for="file in selectedApp.assets.screenshots">
                        <div class="min-w-[220px] h-40 rounded-2xl overflow-hidden bg-black border border-gray-500/20">
                            <template x-if="isVideo(file)">
                                <video :src="file" controls class="w-full h-full object-cover"></video>
                            </template>
                            <template x-if="!isVideo(file)">
                                <img :src="file" class="w-full h-full object-cover">
                            </template>
                        </div>
                    </template>
                </div>

                <div class="px-6 grid gap-3">
                    <div class="flex justify-between text-[10px] font-black opacity-50 uppercase border-b border-gray-500/10 pb-2">
                        <span>Released: <span x-text="selectedApp.releaseDate"></span></span>
                        <span>Updated: <span x-text="selectedApp.lastUpdate"></span></span>
                    </div>
                    <template x-for="v in selectedApp.versions">
                        <div class="p-4 bg-gray-500/10 rounded-2xl flex justify-between items-center">
                            <div>
                                <p class="font-black text-sm" x-text="'v' + v.ver"></p>
                                <p class="text-[10px] text-blue-500 font-black" x-text="v.size"></p>
                            </div>
                            <a :href="v.url" class="px-8 py-2 bg-blue-600 text-white rounded-xl text-[10px] font-black shadow-lg">INSTALL</a>
                        </div>
                    </template>
                </div>

                <div class="px-6 mt-8">
                    <div class="p-4 bg-blue-500/5 rounded-2xl border-l-4 border-blue-600">
                        <h3 class="text-xs font-black text-blue-500 mb-2 uppercase italic">About this game</h3>
                        <p class="text-xs leading-relaxed font-semibold opacity-70" x-text="selectedApp.description"></p>
                    </div>
                </div>

                <div class="px-6 mt-10">
                    <h3 class="font-black text-sm mb-4 uppercase">Recommended for you</h3>
                    <div class="flex gap-4 overflow-x-auto no-scrollbar">
                        <template x-for="recId in selectedApp.rec_ids">
                            <div @click="openDetail(getAppById(recId))" class="min-w-[80px] text-center">
                                <img :src="getAppById(recId).icon" class="w-16 h-16 rounded-2xl mx-auto shadow-sm">
                                <p class="text-[8px] mt-1 font-bold truncate" x-text="getAppById(recId).name"></p>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <div class="fixed bottom-4 right-4 flex flex-col gap-2">
        <button @click="darkMode = !darkMode" class="p-3 bg-blue-600 text-white rounded-full shadow-2xl">üåì</button>
        <button @click="showSettings = true" class="p-3 bg-gray-800 text-white rounded-full shadow-2xl">üìä</button>
    </div>

    <script>
        function storeEngine() {
            return {
                apps: [],
                searchQuery: '',
                darkMode: true,
                viewingDetail: false,
                selectedApp: null,
                sortBy: 'newest',
                
                async init() {
                    const res = await fetch('info.json');
                    const data = await res.json();
                    this.apps = data.apps;
                },

                isVideo(f) { return /\.(mp4|web4|webm)$/i.test(f); },

                shouldShowOffer() {
                    const q = this.searchQuery.toLowerCase();
                    return q !== 'all' && q !== 'allgame' && q !== 'allapp';
                },

                getOffer() { return this.apps.find(a => a.assets.video); },
                getAppById(id) { return this.apps.find(a => a.id === id) || {}; },

                get filteredApps() {
                    const q = this.searchQuery.toLowerCase();
                    let list = this.apps;

                    // 1. COMMAND SYSTEM
                    if (q === 'all') return list;
                    if (q === 'allgame') return list.filter(a => a.type === 'game');
                    if (q === 'allapp') return list.filter(a => a.type === 'app');
                    
                    if (q.startsWith('pub:')) {
                        const owner = q.split(':')[1];
                        return list.filter(a => a.owner.toLowerCase().includes(owner));
                    }
                    if (q.startsWith('category:')) {
                        const cat = q.split(':')[1];
                        return list.filter(a => a.category.toLowerCase() === cat);
                    }

                    // 2. NORMAL SEARCH
                    if (q.length > 0) {
                        list = list.filter(a => a.name.toLowerCase().includes(q) || (a.keywords && a.keywords.some(k => k.toLowerCase().includes(q))));
                    }

                    // 3. SIZE-AWARE SORTING (MB vs GB)
                    list.sort((a, b) => {
                        const parseSize = (app) => {
                            const s = app.versions[0]?.size || "0 MB";
                            const match = s.match(/(\d+(\.\d+)?)\s*(MB|GB)/i);
                            if (!match) return 0;
                            let val = parseFloat(match[1]);
                            return match[3].toUpperCase() === 'GB' ? val * 1024 : val;
                        };

                        if (this.sortBy === 'size-desc') return parseSize(b) - parseSize(a);
                        if (this.sortBy === 'size-asc') return parseSize(a) - parseSize(b);
                        if (this.sortBy === 'newest') return new Date(b.releaseDate) - new Date(a.releaseDate);
                        return 0;
                    });
                    return list;
                },

                openDetail(app) { this.selectedApp = app; this.viewingDetail = true; window.scrollTo(0,0); },
                resetAll() { this.searchQuery = ''; this.viewingDetail = false; }
            }
        }
    </script>
</body>
</html>
